<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Market as a Mirror</title>
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="assets/css/interactive-map.css">
  <link rel="stylesheet" href="assets/vendor/vis-timeline/vis-timeline-graph2d.min.css">
  <script src="assets/vendor/vis-timeline/vis-timeline-graph2d.min.js"></script>

</head>
<body>
<header class="site-header-nav">
    <div class="header-left">
        <a href="#" class="header-logo">The Market as a Mirror</a>
    </div>
    <nav class="header-nav">
        <ul>
          <li><a href="#intro" class="nav-link">Overview</a></li>
          <li><a href="#research-questions" class="nav-link">Research</a></li>
          <li><a href="#methodology" class="nav-link">Methodology</a></li>
          <li><a href="#story" class="nav-link">Anatomy</a></li>
          <li><a href="#sectoral" class="nav-link">Natural Selection</a></li>
          <li><a href="#contagion" class="nav-link">Contagion</a></li>
          <li><a href="#resilience" class="nav-link">Resilience</a></li>
        </ul>
    </nav>
</header>
<div class="hero-title animate-title">
  <h1 class="title-main">The Market as a Mirror</h1>
  <h2 class="title-sub">
    How Global Events Shape Finance (2000–2025)
  </h2>
</div>

<div class="hero-bridge">
  <p class="bridge-kicker">Abstract</p>
  <p class="bridge-text">
        Over the past 25 years, the world has been repeatedly shaken by events that escaped prediction and control. Terrorist attacks, natural disasters, technological breakthroughs, political ruptures, and global health crises have punctuated recent history.
</div>

<div style="width: 100%; height: 750px;">
    <iframe 
        src="assets/visualizations/nasdaq_performance.html" 
        width="100%" 
        height="100%" 
        frameborder="0" 
        scrolling="no">
    </iframe>
</div>

<div class="hero-intro animate-intro" id="intro">
    <p class="intro-label">A market seen through its pulse</p>
    <p class="intro-text">
      Financial markets are not just cold algorithms or rational systems. They are living, social organisms shaped by collective excitement and fear. Beneath charts and models lies a system that reacts, hesitates, panics and adapts.
      <br><br>
      At first glance, the NASDAQ 100 from 2000 to 2025 appears stable as a long-term rise. Yet the curve is not smooth,  just like a pulse under stress. It carries drops, recoveries and sudden disruptions moments when the market loses its balance.
      <br><br>
      Some of these movements align with major events, such as the 2008 financial crisis. Others remain harder to explain. We will examine six landmark U.S. events to explore how crises translate into market behavior.
    </p>
</div>

    <div class="intro-research" id="research-questions">
      <h4 class="intro-subheading">The four research questions</h4>
      <p class="intro-text">
        This data story is structured around four core questions, each corresponding to a chapter in our analysis.
        These questions guide our exploration from immediate reaction to long-term recovery, from observation to interpretation.
      </p>

      <ul class="research-list">
        <li class="research-card">
          <a class="research-link" href="#story">
            <div class="research-number">01</div>
            <div class="research-copy">
              <h5 class="research-title">The Anatomy: Fear or Euphoria?</h5>
              <p class="research-desc">
                When a shock occurs, how does it first manifest in the market? Which assets plummet or surge, and where does trading turn abnormal?
              </p>
            </div>
          </a>
        </li>

        <li class="research-card">
          <a class="research-link" href="#sectoral">
            <div class="research-number">02</div>
            <div class="research-copy">
              <h5 class="research-title">Sectoral Natural Selection</h5>
              <p class="research-desc">
                Are sectoral reactions random, or do different types of crises consistently favor or penalize specific industries?
              </p>
            </div>
          </a>
        </li>

        <li class="research-card">
          <a class="research-link" href="#contagion">
            <div class="research-number">03</div>
            <div class="research-copy">
              <h5 class="research-title">The Speed of Recovery</h5>
              <p class="research-desc">
                How long does it take for the market to recover after a shock, and what does the recovery pace reveal about the nature of the crisis?
              </p>
            </div>
          </a>
        </li>

        <li class="research-card">
          <a class="research-link" href="#resilience">
            <div class="research-number">04</div>
            <div class="research-copy">
              <h5 class="research-title">Predicting Resilience</h5>
              <p class="research-desc">
                Is resilience purely circumstantial, or can structural characteristics explain why some sectors consistently recover faster than others?
              </p>
            </div>
          </a>
        </li>
      </ul>
    </div>

  <div class="methodology-section" id="methodology">
    <p class="section-label">Methodology</p>
    <p class="methodology-intro">
      To understand how markets feel, react, and recover, we perform a systematic
      autopsy of financial crises. Each chapter dissects a different mechanism through
      which global events translate into market behavior.
    </p>

    <div class="methodology-block sampling-block">
      <div class="methodology-copy">
        <p class="method-kicker">Data construction & sampling strategy</p>
        <h4 class="method-block-title">Méthodologie</h4>
        <ul class="method-list">
          <li><strong>Stock selection.</strong> The initial dataset (more than 8,000 assets) required rigorous selection to create a representative and usable sample.</li>
          <li><strong>Exclusion of ETFs.</strong> These instruments are composed of several stocks, often from different sectors. We excluded them to avoid ambiguity in sector analysis.</li>
          <li><strong>Classification.</strong> Stocks were classified across six sectors and segmented by market capitalisation size (small, medium, large).</li>
          <li><strong>Sampling.</strong> Ten stocks were selected for each sector-size combination, giving 30 shares per sector.</li>
          <li><strong>Assembly.</strong> Results were pooled by sector using averages to ensure robustness and limit the influence of isolated company behaviour.</li>
        </ul>
      </div>
    </div>

    <div class="metrics-block">
      <div class="methodology-copy">
        <p class="method-kicker">Quantitative measures</p>
        <h4 class="method-block-title">Mathematics behind analysis</h4>
        <p class="method-paragraph">
          In order to characterise the reaction of financial markets to the events studied, the analysis is based on three main quantitative variables: cumulative abnormal returns (CAR), drawdown (in depth and duration) and recovery time after an event.
        </p>
      </div>

      <div class="metric-grid">
        <div class="metric-card">
          <div class="metric-topline">
            <div>
              <div class="metric-title">CAR</div>
              <div class="metric-subtitle">Relative to QQQ</div>
            </div>
            <span class="metric-tag">Performance</span>
          </div>
          <p class="metric-intuition">
            CAR measures the performance of an asset relative to the market (QQQ), isolating sector-specific moves from the broad trend.
          </p>
          <pre class="metric-formula">AR<sub>i,t</sub> = R<sub>i,t</sub> - R<sub>m,t</sub>
CAR<sub>i</sub>(t<sub>1</sub>, t<sub>2</sub>) = Σ AR<sub>i,t</sub></pre>
          <ul class="metric-interpretation">
            <li><strong>Positive:</strong> outperforming the market.</li>
            <li><strong>Negative:</strong> underperforming the market.</li>
          </ul>
        </div>

        <div class="metric-card">
          <div class="metric-topline">
            <div>
              <div class="metric-title">Drawdown</div>
              <div class="metric-subtitle">Depth & duration</div>
            </div>
            <span class="metric-tag">Risk</span>
          </div>
          <p class="metric-intuition">
            Drawdown captures the maximum loss from a peak and how long it takes to climb back, revealing shock severity and persistence.
          </p>
          <pre class="metric-formula">DD<sub>t</sub> = (P<sub>t</sub> - max(P)) / max(P)
depth = min(DD<sub>t</sub>)
duration = t<sub>reclaim</sub> - t<sub>peak</sub></pre>
          <ul class="metric-interpretation">
            <li><strong>Deep:</strong> high exposure to downside risk.</li>
            <li><strong>Long:</strong> slow absorption and correction of the shock.</li>
          </ul>
        </div>

        <div class="metric-card">
          <div class="metric-topline">
            <div>
              <div class="metric-title">Recovery</div>
              <div class="metric-subtitle">Time back to pre-event</div>
            </div>
            <span class="metric-tag">Resilience</span>
          </div>
          <p class="metric-intuition">
            Recovery time measures how quickly an asset returns to its pre-event peak; if never regained, the horizon is censored.
          </p>
          <pre class="metric-formula">T<sub>rec</sub> = t<sub>rec</sub> - t<sub>peak</sub></pre>
          <ul class="metric-interpretation">
            <li><strong>Short:</strong> fast rebound and resilient sector.</li>
            <li><strong>Long/NA:</strong> persistent damage or incomplete recovery.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="chapter-section fear-section" id="story">
    <div class="fear-copy">
      <h3 class="section-label">The Anatomy of Fear & Euphoria</h3>
      <p>
        <strong>When fear enters the system</strong>
      </p>
      <p>
      Fear is rarely uniform. In some moments, it erupts suddenly and overwhelms the entire market. In others, it spreads slowly, hesitates, or even coexists with optimism. The same system, exposed to different shocks, can react in profoundly different ways.
      </p>
      <p>
      This raises a fundamental question: when uncertainty strikes, does the market respond according to fixed rules, or does each event trigger a unique emotional reaction? Is fear an automatic reflex, or a context-dependent response shaped by expectations, narratives, and collective interpretation?
      </p>
      <p> 
      To explore this question, we begin by observing the market as a whole. Before focusing on individual sectors, we examine how the QQQ index behaves around six major events, all aligned on a common timeline. By normalizing each trajectory at the event date, we isolate the market’s immediate response to uncertainty.
      </p>
      <p>
      Only then does the pattern emerge. Some events provoke sharp and immediate declines, others lead to hesitation, and a few are followed by rapid recoveries or even rallies. In certain cases, fear fades quickly; in others, it persists well beyond the initial shock. Yet across all events, one feature remains constant: a clear disruption around the moment the shock occurs.
      </p>
      <p>
      This comparison reveals that fear does not have a single signature. The same market can panic, stall, or rebound depending not only on the magnitude of the event, but on how it is perceived and absorbed by investors.
      </p>
      <p>
      This chapter zooms in on these first moments. By breaking each event down into sector-level reactions, we examine how fear enters the system — sometimes concentrated, sometimes systemic — and how its early form already hints at the dynamics that will follow.
      </p>
    </div>

    <div class="fear-sticky">
      <div class="fear-sticky-inner">
        <div class="fear-sticky-left">
          <div class="fear-sticky-title"></div>
          <div class="chip-row">
            <span class="chip-row-label">Event</span>
            <div class="chip-row-items" id="event-chips"></div>
          </div>
          <div class="chip-row">
            <span class="chip-row-label">Sector</span>
            <div class="chip-row-items" id="sector-chips"></div>
          </div>
        </div>
        <div class="fear-sticky-right">
          <div class="status-row">
            <div class="selection-status" id="selection-status">
              Selected: —
            </div>
            <div class="update-hint" id="update-hint">Updated</div>
          </div>
          <p class="insight-body" id="insight-body">
            Select an event and sector above to reveal the narrative written in the insight JSON file.
          </p>
        </div>
      </div>
    </div>

    <div class="fear-charts">
      <div class="chart-card chart-card-full">
        <div class="chart-card-header">
          <div class="chart-title">CAR</div>
          <div class="chart-subtitle">Cumulative abnormal returns around the event</div>
        </div>
        <div class="chart-body">
          <img id="chart-car" alt="CAR chart" loading="lazy">
          <div class="chart-missing" data-for="chart-car">Image not available</div>
        </div>
      </div>

      <div class="chart-card chart-card-full">
        <div class="chart-card-header">
          <div class="chart-title">Drawdown</div>
          <div class="chart-subtitle">Depth and duration of market drops</div>
        </div>
        <div class="chart-body">
          <img id="chart-drawdown" alt="Drawdown chart" loading="lazy">
          <div class="chart-missing" data-for="chart-drawdown">Image not available</div>
        </div>
      </div>

      <div class="chart-card chart-card-full">
        <div class="chart-card-header">
          <div class="chart-title">Volcano</div>
          <div class="chart-subtitle">Cross-sectional impact during the shock</div>
        </div>
        <div class="chart-body">
          <img id="chart-volcano" alt="Volcano chart" loading="lazy">
          <div class="chart-missing" data-for="chart-volcano">Image not available</div>
        </div>
      </div>
    </div>

    <div class="fear-copy">
      <p>
        Across the six events and thirty-six sectoral reactions, one insight emerges clearly: fear and euphoria do not enter the market uniformly. They follow distinct paths, shaped by the nature of the shock and the structural role of each sector.
      </p> 
      <p>
        Fear appears first as an imbalance. In sudden crises such as geopolitical attacks, financial collapses, or global health emergencies, it manifests immediately and violently, producing sharp drawdowns and intense trading activity. In these moments, sectors directly exposed to trust, mobility, liquidity, or global demand amplify stress, while more defensive sectors absorb it. The market fragments. 
      </p>
      <p>
        In contrast, not all disruptions trigger fear. Innovation-driven events and political shifts often give rise to anticipation rather than panic. In these cases, optimism remains concentrated, benefiting specific sectors while leaving others largely unaffected. Euphoria, unlike fear, does not spread systemically. It is selective. This asymmetry reveals a key feature of market behavior. Fear tends to propagate quickly and broadly, erasing sectoral boundaries during extreme stress. Euphoria, on the other hand, remains localized, reinforcing existing structures rather than dismantling them. The market does not simply react to events; it interprets them. Ultimately, this chapter answers the first research question: the anatomy of fear and euphoria is neither random nor symmetric. The same market can panic, hesitate, or rally depending on how a shock is perceived and which parts of the system are most exposed. The earliest reactions already contain the blueprint of what follows.
      </p>
      <p>
        Understanding these first moments is essential. Before resilience can be measured, before recovery can be compared, the initial form of fear must be observed. The next chapter explores whether these early reactions translate into longer-term patterns or whether survival in the market follows a different logic altogether.
      </p>
    </div>

  </div>
  <script type="module">
    import { getAllEvents } from './assets/js/eventUtils.js';
    import { getAllSectors } from './assets/js/sectorUtils.js';
    import { getChartPaths } from './assets/js/chartPathUtils.js';
    import { getInsight } from './assets/js/insightUtils.js';

    const CORAL = '#f9624f';
    const eventChips = document.getElementById('event-chips');
    const sectorChips = document.getElementById('sector-chips');
    const statusEl = document.getElementById('selection-status');
    const updateHint = document.getElementById('update-hint');

    const chartEls = {
      car: document.getElementById('chart-car'),
      drawdown: document.getElementById('chart-drawdown'),
      volcano: document.getElementById('chart-volcano')
    };

    const missingEls = {
      car: document.querySelector('[data-for="chart-car"]'),
      drawdown: document.querySelector('[data-for="chart-drawdown"]'),
      volcano: document.querySelector('[data-for="chart-volcano"]')
    };

    const insightBody = document.getElementById('insight-body');

    let events = [];
    let sectors = [];
    let selectedEventId = null;
    let selectedSectorKey = null;
    let hintTimer = null;

    function setChipVisual(chip, active) {
      chip.classList.toggle('active', active);
    }

    function renderEventChips() {
      eventChips.innerHTML = '';
      events.forEach(event => {
        const chip = document.createElement('button');
        chip.className = 'chip';
        chip.style.setProperty('--chip-color', CORAL);
        chip.textContent = event.name;
        setChipVisual(chip, event.id === selectedEventId);
        chip.addEventListener('click', () => {
          if (selectedEventId === event.id) return;
          selectedEventId = event.id;
          renderEventChips();
          updateSelection();
        });
        eventChips.appendChild(chip);
      });
    }

    function renderSectorChips() {
      sectorChips.innerHTML = '';
      sectors.forEach(sector => {
        const chip = document.createElement('button');
        chip.className = 'chip';
        chip.style.setProperty('--chip-color', sector.color || CORAL);
        chip.textContent = sector.label;
        setChipVisual(chip, String(sector.key) === String(selectedSectorKey));
        chip.addEventListener('click', () => {
          if (String(selectedSectorKey) === String(sector.key)) return;
          selectedSectorKey = sector.key;
          renderSectorChips();
          updateSelection();
        });
        sectorChips.appendChild(chip);
      });
    }

    function updateStatus() {
      const event = events.find(item => item.id === selectedEventId);
      const sector = sectors.find(item => String(item.key) === String(selectedSectorKey));
      if (!event || !sector) {
        statusEl.textContent = 'Selected: —';
        return;
      }
      statusEl.textContent = `Selected: ${event.name} × ${sector.label}`;
    }

    function showUpdateHint() {
      updateHint.classList.add('show');
      if (hintTimer) clearTimeout(hintTimer);
      hintTimer = setTimeout(() => updateHint.classList.remove('show'), 900);
    }

    function setChart(target, missingEl, src, alt) {
      if (!target || !missingEl) return;
      if (!src) {
        target.removeAttribute('src');
        missingEl.classList.add('visible');
        return;
      }
      missingEl.classList.remove('visible');
      target.onload = () => missingEl.classList.remove('visible');
      target.onerror = () => {
        missingEl.classList.add('visible');
        target.removeAttribute('src');
      };
      target.src = src;
      target.alt = alt;
    }

    async function updateCharts() {
      const paths = await getChartPaths(selectedEventId, selectedSectorKey);
      const event = events.find(item => item.id === selectedEventId);
      const sector = sectors.find(item => String(item.key) === String(selectedSectorKey));
      const descriptor = event && sector ? `${event.name} × ${sector.label}` : '';

      setChart(chartEls.car, missingEls.car, paths.car, `CAR — ${descriptor}`);
      setChart(chartEls.drawdown, missingEls.drawdown, paths.drawdown, `Drawdown — ${descriptor}`);
      setChart(chartEls.volcano, missingEls.volcano, paths.volcano, `Volcano — ${descriptor}`);
    }

    async function updateInsight() {
      const event = events.find(item => item.id === selectedEventId);
      const sector = sectors.find(item => String(item.key) === String(selectedSectorKey));

      if (!event || !sector) {
        insightBody.textContent = 'Select a combination above to read the interpretation.';
        return;
      }

      const insight = await getInsight(selectedEventId, selectedSectorKey);
      const fallback = `${event.name} × ${sector.label}`;
      insightBody.textContent = insight?.insight || `No interpretation has been written for ${fallback}.`;
    }

    async function updateSelection() {
      updateStatus();
      await Promise.all([updateCharts(), updateInsight()]);
      showUpdateHint();
    }

    (async function initFear() {
      events = await getAllEvents();
      sectors = await getAllSectors();

      if (!events.length || !sectors.length) return;

      selectedEventId = events[0].id;
      selectedSectorKey = sectors[0].key;

      renderEventChips();
      renderSectorChips();
      await updateSelection();
    })().catch(error => {
      console.error('Failed to initialize fear section', error);
    });
  </script>
  <div class="chapter-section" id="sectoral">
    <h3>Sectoral Natural Selection</h3>
    
    <p>
      <strong>From Isolated Reactions to Relative Outcomes</strong>
    </p>
    <p>
      In the previous chapter, sectors were examined in isolation to capture the "anatomy of initial stress". Observing how fear or euphoria manifested within each industry independently. This chapter adopts a broader perspective: rather than asking how each sector reacts on its own, we examine how they react relative to one another.
    </p>
    <p>
      Once the first wave of shock passes, markets begin to differentiate. Capital flows shift and new hierarchies emerge as some industries stabilize while others continue to deteriorate. By observing the Cumulative Abnormal Return (CAR) relative to the QQQ benchmark, we can identify a form of "sectoral natural selection." This approach moves beyond absolute reactions to reveal the relative position of each sector within the market structure.    
    </p>
    <p>
      The central question is whether these outcomes are random or if specific types of crises systematically reshape sectoral hierarchies. To address this, we use heatmaps to provide a compressed, comparative view of sector trajectories over a 90-day period (from D-30 to D+60). This allows us to distinguish between:
    </p>
    <ul>
      <li> Safe Havens: Defensive sectors that absorb stress and outperform during crises.</li>
      <li>Exposed Sectors: Vulnerable industries that bear the brunt of the shock.</li>
      <li>Opportunistic Beneficiaries: Sectors that adapt or capitalize on a sudden paradigm shift.</li> 
    </ul>
    <p>
      Each heatmap thus reveals the competitive hierarchy imposed by the market in response to the unexpected, exposing contrasts that remain invisible when sectors are analyzed in isolation.
    </p>

    <div class="fear-sticky heatmap-sticky">
      <div class="fear-sticky-inner">
        <div class="fear-sticky-left">
          <div class="fear-sticky-title">Sectoral Natural Selection</div>
          <div class="chip-row">
            <span class="chip-row-label">Event</span>
            <div class="chip-row-items" id="heatmap-event-chips"></div>
          </div>
        </div>
        <div class="fear-sticky-right">
          <div class="status-row">
            <div class="selection-status" id="heatmap-selection-status">Selected: —</div>
            <div class="update-hint" id="heatmap-update-hint">Updated</div>
          </div>
          <p class="insight-body" id="heatmap-insight-body">
            Select an event above to read the heatmap interpretation.
          </p>
        </div>
      </div>
    </div>

    <div class="chart-card chart-card-full">
      <div class="chart-card-header">
        <div class="chart-title">Sector Heatmap</div>
        <div class="chart-subtitle">Evolution of sector performance around the event</div>
      </div>
      <div class="chart-body">
        <img id="heatmap-img" alt="Sector heatmap" loading="lazy">
        <div class="chart-missing" data-for="heatmap-img">Image not available</div>
      </div>
    </div>

    <div class="fear-copy">
      <p>
        By placing sectors side by side, rather than observing them in isolation, clear patterns begin to emerge. While Chapter 1 revealed how fear enters the system, this chapter shows how that fear reorganizes the market.
      </p>
      <p>
        Across events, sectoral reactions are not random. Different types of crises consistently reshape relative performance, favoring certain industries while penalizing others. Defensive and structurally essential sectors tend to absorb stress during geopolitical and health-related crises, while cyclical and energy-dependent industries are more exposed. Political and innovation-driven events, in contrast, redistribute performance without triggering systemic fear.
      </p>
      <p>
        Crucially, these patterns only become visible through comparison. When examined independently, sectoral reactions appear noisy and idiosyncratic. When viewed together, they reveal structure.
      </p>
      <p>
        This chapter therefore answers the research question clearly but cautiously: crises do not produce random sectoral outcomes. They act as selective pressures that reorder the market, not through deterministic rules, but through recurring tendencies.
      </p>
      <p>
        With these relative patterns established, the next chapter shifts focus once again — from who performs better or worse to how quickly the market recovers.
      </p>
    </div>

  </div>
  <script type="module">
    import { getAllEvents } from './assets/js/eventUtils.js';
    import { getSectorHeatmapPath, getRecoveryChartPath } from './assets/js/chartPathUtils.js';
    import { getHeatmapInsight } from './assets/js/heatmapInsightUtils.js';
    import { getRecoveryInsight } from './assets/js/recoveryInsightUtils.js';

    const CORAL2 = '#f9624f';
    const heatmapEventChips = document.getElementById('heatmap-event-chips');
    const heatmapStatusEl = document.getElementById('heatmap-selection-status');
    const heatmapUpdateHint = document.getElementById('heatmap-update-hint');
    const heatmapImg = document.getElementById('heatmap-img');
    const heatmapMissing = document.querySelector('[data-for="heatmap-img"]');
    const heatmapInsightBody = document.getElementById('heatmap-insight-body');

    const recoveryEventChips = document.getElementById('recovery-event-chips');
    const recoveryStatusEl = document.getElementById('recovery-selection-status');
    const recoveryUpdateHint = document.getElementById('recovery-update-hint');
    const recoveryImg = document.getElementById('recovery-img');
    const recoveryMissing = document.querySelector('[data-for="recovery-img"]');
    const recoveryInsightBody = document.getElementById('recovery-insight-body');

    let heatmapEvents = [];
    let selectedHeatmapEventId = null;
    let heatmapHintTimer = null;

    let recoveryEvents = [];
    let selectedRecoveryEventId = null;
    let recoveryHintTimer = null;

    function setChipVisual(chip, active) {
      chip.classList.toggle('active', active);
    }

    function renderHeatmapEventChips() {
      heatmapEventChips.innerHTML = '';
      heatmapEvents.forEach(event => {
        const chip = document.createElement('button');
        chip.className = 'chip';
        chip.style.setProperty('--chip-color', CORAL2);
        chip.textContent = event.name;
        setChipVisual(chip, event.id === selectedHeatmapEventId);
        chip.addEventListener('click', () => {
          if (selectedHeatmapEventId === event.id) return;
          selectedHeatmapEventId = event.id;
          renderHeatmapEventChips();
          updateHeatmap();
        });
        heatmapEventChips.appendChild(chip);
      });
    }

    function showHeatmapHint() {
      heatmapUpdateHint.classList.add('show');
      if (heatmapHintTimer) clearTimeout(heatmapHintTimer);
      heatmapHintTimer = setTimeout(() => heatmapUpdateHint.classList.remove('show'), 900);
    }

    function updateHeatmapStatus() {
      const event = heatmapEvents.find(item => item.id === selectedHeatmapEventId);
      heatmapStatusEl.textContent = event ? `Selected: ${event.name}` : 'Selected: —';
    }

    function setHeatmapImage(src, alt) {
      if (!heatmapImg || !heatmapMissing) return;
      if (!src) {
        heatmapImg.removeAttribute('src');
        heatmapMissing.classList.add('visible');
        return;
      }
      heatmapMissing.classList.remove('visible');
      heatmapImg.onload = () => heatmapMissing.classList.remove('visible');
      heatmapImg.onerror = () => {
        heatmapMissing.classList.add('visible');
        heatmapImg.removeAttribute('src');
      };
      heatmapImg.src = src;
      heatmapImg.alt = alt;
    }

    async function updateHeatmap() {
      const path = await getSectorHeatmapPath(selectedHeatmapEventId);
      const event = heatmapEvents.find(item => item.id === selectedHeatmapEventId);
      const descriptor = event ? `Sector Heatmap — ${event.name}` : 'Sector Heatmap';
      updateHeatmapStatus();
      setHeatmapImage(path, descriptor);
      await updateHeatmapInsight(event);
      showHeatmapHint();
    }

    async function updateHeatmapInsight(event) {
      if (!heatmapInsightBody) return;
      if (!event) {
        heatmapInsightBody.textContent = 'Select an event above to read the heatmap interpretation.';
        return;
      }
      const insight = await getHeatmapInsight(event.id);
      heatmapInsightBody.textContent = insight?.insight || `No interpretation has been written for ${event.name}.`;
    }

    (async function initHeatmap() {
      heatmapEvents = await getAllEvents();
      if (!heatmapEvents.length) return;
      selectedHeatmapEventId = heatmapEvents[0].id;
      renderHeatmapEventChips();
      await updateHeatmap();
    })().catch(error => {
      console.error('Failed to initialize heatmap section', error);
    });

    function renderRecoveryEventChips() {
      recoveryEventChips.innerHTML = '';
      recoveryEvents.forEach(event => {
        const chip = document.createElement('button');
        chip.className = 'chip';
        chip.style.setProperty('--chip-color', CORAL2);
        chip.textContent = event.name;
        setChipVisual(chip, event.id === selectedRecoveryEventId);
        chip.addEventListener('click', () => {
          if (selectedRecoveryEventId === event.id) return;
          selectedRecoveryEventId = event.id;
          renderRecoveryEventChips();
          updateRecovery();
        });
        recoveryEventChips.appendChild(chip);
      });
    }

    function showRecoveryHint() {
      recoveryUpdateHint.classList.add('show');
      if (recoveryHintTimer) clearTimeout(recoveryHintTimer);
      recoveryHintTimer = setTimeout(() => recoveryUpdateHint.classList.remove('show'), 900);
    }

    function updateRecoveryStatus() {
      const event = recoveryEvents.find(item => item.id === selectedRecoveryEventId);
      recoveryStatusEl.textContent = event ? `Selected: ${event.name}` : 'Selected: —';
    }

    function setRecoveryImage(src, alt) {
      if (!recoveryImg || !recoveryMissing) return;
      if (!src) {
        recoveryImg.removeAttribute('src');
        recoveryMissing.classList.add('visible');
        return;
      }
      recoveryMissing.classList.remove('visible');
      recoveryImg.onload = () => recoveryMissing.classList.remove('visible');
      recoveryImg.onerror = () => {
        recoveryMissing.classList.add('visible');
        recoveryImg.removeAttribute('src');
      };
      recoveryImg.src = src;
      recoveryImg.alt = alt;
    }

    async function updateRecovery() {
      const path = await getRecoveryChartPath(selectedRecoveryEventId);
      const event = recoveryEvents.find(item => item.id === selectedRecoveryEventId);
      const descriptor = event ? `Recovery — ${event.name}` : 'Recovery';
      updateRecoveryStatus();
      setRecoveryImage(path, descriptor);
      await updateRecoveryInsight(event);
      showRecoveryHint();
    }

    async function updateRecoveryInsight(event) {
      if (!recoveryInsightBody) return;
      if (!event) {
        recoveryInsightBody.textContent = 'Select an event above to see the recovery chart and interpretation.';
        return;
      }
      const insight = await getRecoveryInsight(event.id);
      recoveryInsightBody.textContent = insight?.insight || `No interpretation has been written for ${event.name}.`;
    }

    (async function initRecovery() {
      recoveryEvents = await getAllEvents();
      if (!recoveryEvents.length) return;
      selectedRecoveryEventId = recoveryEvents[0].id;
      renderRecoveryEventChips();
      await updateRecovery();
    })().catch(error => {
      console.error('Failed to initialize recovery section', error);
    });
  </script>
  <div class="chapter-section" id="contagion">
    <h3>The Speed of Contagion</h3>
    <p><strong>When does the system begin to heal?</strong></p>
    <p>
      In the previous chapters, we observed how stress enters the market and redistributes across sectors. We analyzed the intensity of fear and the hierarchy of relative outcomes. However, the severity of a shock is not defined by its initial impact alone; it is equally determined by its duration. Some disturbances provoke sharp reactions followed by rapid stabilization, while others leave the market weakened and unable to return to its previous state for months.    </p>
    <p>
      This chapter shifts the focus to the temporal dimension of the crisis. We seek to measure the system’s ability to absorb uncertainty and restore balance by observing how long it takes for different parts of the market to regain their pre-event equilibrium. Recovery time acts as a vital sign: it allows us to distinguish between temporary volatility shocks and structural trend breaks that linger like chronic conditions.
    </p>
    <p>
      To quantify this pace of recovery and understand the depth of contagion, we employ boxplots for each of the six events studied. This approach allows for a precise analysis of the distribution of recovery times:
    </p>
    <ul>
      <li>
      Indicator: The measurement is expressed in days required for the share price to return to its specific valuation on the day of the event.
      </li>
      <li>
      Distribution Analysis: Our analysis focuses on three key metrics:
        <ul>
          <li>The Median: Reflecting the average velocity of recovery for a sector.</li>
          <li>The Interquartile Range (IQR): Measuring the homogeneity of the sectoral response.</li>
          <li>Outliers: Identifying isolated cases of extreme vulnerability or prolonged distress.</li>
        </ul>
    
     </li>
    </ul>
      <p>
        Together, these boxplots reveal whether a shock fades like a passing fever or persists as a long-term scar on the market's stability.
      </p>
    <div class="fear-sticky heatmap-sticky">
      <div class="fear-sticky-inner">
        <div class="fear-sticky-left">
          <div class="fear-sticky-title">Recovery Time</div>
          <div class="chip-row">
            <span class="chip-row-label">Event</span>
            <div class="chip-row-items" id="recovery-event-chips"></div>
          </div>
        </div>
        <div class="fear-sticky-right">
          <div class="status-row">
            <div class="selection-status" id="recovery-selection-status">Selected: —</div>
            <div class="update-hint" id="recovery-update-hint">Updated</div>
          </div>
          <p class="insight-body" id="recovery-insight-body">
            Select an event above to see the recovery chart and interpretation.
          </p>
        </div>
      </div>
    </div>

    <div class="chart-card chart-card-full">
      <div class="chart-card-header">
        <div class="chart-title">Recovery Time by Event</div>
        <div class="chart-subtitle">Distribution of days to regain pre-shock levels</div>
      </div>
      <div class="chart-body">
        <img id="recovery-img" alt="Recovery time chart" loading="lazy">
        <div class="chart-missing" data-for="recovery-img">Image not available</div>
      </div>
    </div>

    <div class="fear-copy">
      <p>
        <strong>From shock to recovery</strong> 
      </p>
      <p>
        Across events, one pattern becomes clear: shocks do not leave the system at the same speed they enter it. Some propagate rapidly but dissipate just as fast. Others spread more slowly, embedding themselves deep into market dynamics.
      </p>
      <p>
        Localized events tend to produce uneven but relatively quick recoveries, affecting specific sectors while leaving others largely intact. Systemic crises, by contrast, alter the market’s internal equilibrium. In those cases, recovery is not only slower — it is fragmented. Some sectors heal early, others remain impaired long after the initial shock.
      </p>
      <p>
        More recent crises show a different rhythm. Despite their intensity, recovery often occurs faster and more synchronously across sectors. Information circulates more rapidly, expectations adjust sooner, and capital repositions with greater speed. The system reacts faster — but it also stabilizes faster.
      </p>
      <p>
        Recovery time therefore tells us something fundamental. It reveals not just how hard the market was hit, but how deeply the shock disrupted its internal functioning.
      </p>
      <p>
        Having traced how stress fades and balance returns, one final question remains: is resilience purely reactive — or can it be anticipated before the shock even occurs? That question leads us to the final chapter.
      </p>
    </div>

  </div>
  <div class="chapter-section" id="resilience">
    <h3>Predicting Resilience</h3>
    <p><strong>Can resilience be diagnosed?</strong></p>
    <p>
      After observing how shocks emerge, spread, and eventually fade, we reach the final stage of our examination. The symptoms are familiar now. The reactions have been measured. Recovery times have been compared.
    </p>
    <p>
      One question remains:
    </p>
    <p>
      Is resilience merely something we observe in hindsight — or does the market carry pre-existing strengths that make some sectors more likely to recover than others?
    </p>
    <p>
      In medicine, recovery is rarely random. Age, structure, exposure, and underlying conditions all shape how a body responds to stress. Markets may not be so different. Some sectors appear fragile under pressure, while others repeatedly regain balanceFais moi  regardless of the nature of the shock.
    </p>
    <p>
      This chapter explores whether resilience leaves a trace.
    </p>

    <div class="chart-card chart-card-full">
      <div class="chart-card-header">
        <div class="chart-title">Recovery Snapshot</div>
        <div class="chart-subtitle">CAR at +60 days across events and sectors</div>
      </div>
      <div class="chart-body">
        <img src="assets/img/plots/chapter2/global_heatmap_car.png" alt="Global heatmap of CAR at +60 days" loading="lazy">
        <div class="chart-missing" data-for="global-heatmap-car">Image not available</div>
      </div>
    </div>

    <div class="fear-copy">
      <p>
        The heatmap below captures sector performance sixty days after each event, measured through cumulative abnormal returns relative to the benchmark. By freezing the market at a common recovery horizon, this visualization allows direct comparison across sectors and crisis types.
      </p>
      <p>
        Several tendencies emerge clearly. Health Care displays a consistently positive recovery profile, largely independent of the event. Finance rebounds strongly after political and systemic disruptions, yet falters during health-driven crises. Energy reacts sharply to context, recovering after geopolitical shocks but suffering persistent losses after COVID-19. Technology benefits from innovation and political clarity, while remaining fragile under uncertainty. Basic Industries and Transportation show recovery patterns that depend heavily on the nature of the disruption.
      </p>
      <p>
        Rather than revealing universal winners, this snapshot highlights conditional resilience — strength that depends on context.
      </p>
    </div>

    <div class="chart-card chart-card-full">
      <div class="chart-card-header">
        <div class="chart-title">What Drives Recovery?</div>
        <div class="chart-subtitle">Model-based view of factors linked to resilience</div>
      </div>
      <div class="chart-body">
        <img src="assets/img/plots/chapter2/forest_plot_car.png" alt="Forest plot of factors influencing recovery" loading="lazy">
        <div class="chart-missing" data-for="forest-plot-car">Image not available</div>
      </div>
    </div>

    <div class="fear-copy">
      <p>
        Patterns alone do not explain resilience. To move beyond visual comparison, we introduce a model-based perspective designed to isolate which characteristics are systematically associated with faster recovery.
      </p>
      <p>
        The forest plot summarizes the estimated influence of structural factors such as sector affiliation and firm characteristics on recovery outcomes. Each coefficient reflects how strongly a given factor shifts the probability or speed of recovery, holding others constant. Some effects emerge as stable and directional, while others remain weak or inconclusive.
      </p>
      <p>
        This approach does not promise prediction in the strict sense. Instead, it offers a diagnostic lens identifying which features consistently matter when the system attempts to restore equilibrium.
      </p>
    </div>

    <div class="fear-copy">
      <p>
        Resilience is not random. It emerges from the interaction between the shock and the structure of the market. Markets do not anticipate trauma — but in recovery, they reveal their architecture.
      </p>
    </div>

    <p>
      <strong>What resilience reveals</strong>
    </p>
    <p>
      This chapter suggests that market resilience is neither random nor uniform. It emerges from an interaction between the nature of the shock and the internal structure of the market. Certain sectors repeatedly demonstrate an ability to recover — but only when the disruption aligns with their structural strengths. Others remain vulnerable when shocks directly target their core dependencies.
    </p>
    <p>
      Resilience, then, is not simply about surviving a crisis. It is about how well a sector is built to absorb stress, reallocate resources, and adapt once the initial shock has passed. While resilience cannot be predicted with certainty for a given event, it leaves identifiable traces that make some outcomes more likely than others.
    </p>
    <p>
      Markets do not anticipate trauma. But under stress, they reveal their architecture. And it is not in collapse, but in recovery, that resilience becomes visible.
    </p>

  </div>
  <div class="chapter-section">
    <h3>Crisis Playbook — The Action Guide</h3>
    <p>
      Finally, we synthesize our findings into a practical framework.
      This chapter translates historical patterns into insights that help
      interpret future crises.
    </p>
    <p>
      Rather than predicting the next shock, our goal is to understand how markets
      are likely to react — and how fear, resilience, and recovery tend to unfold.
    </p>
    <div class="idx-main-wrapper" id="idx-container">
      <div class="idx-column" id="idx-events">
          <div class="idx-item" data-id="terrorist attack">Terrorist attack</div>
          <div class="idx-item" data-id="natural disaster">Natural disaster</div>
          <div class="idx-item" data-id="financial Crisis">Financial Crisis</div>
          <div class="idx-item" data-id="tech-boom">Technological Boom</div>
          <div class="idx-item" data-id="political event">Political event</div>
          <div class="idx-item" data-id="public Health Crisis">Public Health Crisis</div>
      </div>

      <svg id="idx-svg-canvas">
          <defs>
              <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
              </marker>
          </defs>
      </svg>

      <div class="idx-column" id="idx-sectors">
          <div class="idx-item" data-sector="basic Industries">Basic Industries</div>
          <div class="idx-item" data-sector="energy">Energy</div>
          <div class="idx-item" data-sector="finance">Finance</div>
          <div class="idx-item" data-sector="health Care">Health Care</div>
          <div class="idx-item" data-sector="tech">Technology</div>
          <div class="idx-item" data-sector="transportation">Transportation</div>
      </div>
  </div>

  <script src="assets/js/interactive-map.js"></script>
  <script src="assets/js/scroll-spy-nav-bar.js"></script>
  
  <script>
      const myMapping = {
      'terrorist attack': ['basic Industries', 'health Care'],
      'natural disaster': ['finance'],
      'financial Crisis': ['finance', 'tech','transportation','health Care'],
      'tech-boom': ['basic Industries', 'transportation','finance','tech'],
      'political event': ['finance','transportation', 'basic Industries'],
      'public Health Crisis': ['health Care', 'tech']
    };
      
      window.onload = () => initInteractiveMap(myMapping);
  </script>

  </div>
  <div class="chapter-section">
    <div class="fear-copy">
      <p><strong>Final message to the reader</strong></p>
      <p>You don’t need to predict crises. You need to recognize patterns.</p>
      <p>Markets don’t think. They react.</p>
      <p>And like any system under stress, their behavior leaves traces — if you know how to read the signs.</p>
    </div>
  </div>

  <footer class="site-footer">
    <p>
      ADA Project · DataPandas · EPFL © 2025
    </p>
  </footer>
  
</body>
</html>
